<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Project Environment Hub</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #eef2f8; /* Very light blue background */
            min-height: 100vh;
            padding: 2rem 1rem;
        }
        .container-main {
            max-width: 1200px;
            width: 100%;
            background-color: #ffffff;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            padding: 2rem;
        }
        .tab-btn {
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid transparent;
        }
        .tab-btn.active {
            background-color: #3b82f6; /* Blue 500 */
            color: white;
            box-shadow: 0 4px 8px rgba(59, 130, 246, 0.3);
        }
        .tab-btn:not(.active):hover {
            background-color: #eff6ff; /* Blue 50 */
            color: #1d4ed8; /* Blue 700 */
        }
        th {
            background-color: #1f2937; /* Darker header background */
            color: #ffffff;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        td a { color: #2563eb; text-decoration: none; }
        td a:hover { text-decoration: underline; }
        .search-input {
            padding: 0.75rem 1rem;
            border: 2px solid #d1d5db;
            border-radius: 10px;
            width: 100%;
            font-size: 1rem;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.08);
        }
        .search-input:focus {
            border-color: #3b82f6;
            outline: none;
        }
        
        /* Responsive Table Styling */
        @media (max-width: 768px) {
            .container-main { padding: 1rem; }
            .tab-btn { padding: 0.5rem 1rem; font-size: 0.875rem; }
            .tabs-container { flex-direction: column; gap: 0.5rem; }
            table, thead, tbody, th, td, tr { display: block; }
            thead tr { position: absolute; top: -9999px; left: -9999px; }
            tr { border: 1px solid #e5e7eb; margin-bottom: 0.75rem; border-radius: 8px; }
            td {
                border: none;
                position: relative;
                padding-left: 50%;
                text-align: right;
            }
            td:before {
                position: absolute;
                top: 0;
                left: 6px;
                width: 45%;
                padding-right: 10px;
                white-space: nowrap;
                text-align: left;
                font-weight: 600;
                color: #4b5563;
                content: attr(data-label);
            }
        }
    </style>
</head>
<body class="flex justify-center">
    <div class="container-main">
        <h1 class="text-4xl font-extrabold text-gray-800 mb-2 text-center">OSM GOC Hub</h1>
        <p class="text-gray-500 mb-8 text-center">Your consolidated resource for all project documentation and links.</p>

        <!-- SECURITY ALERT AND INSTRUCTIONS -->
        <div class="p-4 mb-8 bg-yellow-50 border-l-4 border-yellow-500 rounded-lg">
            <div class="flex items-center">
                <svg class="w-5 h-5 text-yellow-500 mr-3" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M8.257 3.099c.765-1.427 2.658-1.427 3.423 0l5.485 10.273c.755 1.413-.207 3.011-1.72 3.011H4.502c-1.513 0-2.475-1.598-1.72-3.011L8.257 3.099z" clip-rule="evenodd"></path></svg>
                <p class="font-bold text-sm text-yellow-700">Hosting and Access Note</p>
            </div>
            <p class="mt-2 text-sm text-yellow-600">
                This repository must be hosted as a **Private GitHub Page** for security. If links are not clickable (text link or file path shown in gray), it means the page is being viewed directly from the repository code (not the live site) or GitHub Pages is not yet fully enabled. **Action:** Ensure you have the necessary GitHub Enterprise access to publish Pages privately.
            </p>
        </div>
        <!-- END ALERT -->

        <!-- Project Tabs -->
        <div id="tabsContainer" class="tabs-container flex flex-wrap gap-3 mb-6 border-b-2 border-gray-200 pb-3">
            <!-- Tabs will be dynamically generated here -->
        </div>

        <!-- Search Bar -->
        <input type="text" id="searchInput" class="search-input mb-8" placeholder="Quick Search: Type to filter the current project's links and documents...">

        <!-- Table View -->
        <div class="overflow-x-auto rounded-xl shadow-lg">
            <table id="cheatSheetTable" class="w-full text-sm text-left text-gray-700">
                <thead>
                    <tr>
                        <th class="px-4 py-3 rounded-tl-xl">Category</th>
                        <th class="px-4 py-3">Item/Topic</th>
                        <th class="px-4 py-3">Description</th>
                        <th class="px-4 py-3">Link/Location</th>
                        <th class="px-4 py-3 rounded-tr-xl">Notes/Comments</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <!-- Loading message initially -->
                    <tr>
                        <td colspan="5" class="text-center py-8 text-blue-500 font-semibold">
                            Loading project data...
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Global variable to hold the loaded data
        let PROJECT_DATA = {};
        const tableBody = document.getElementById('tableBody');
        const tabsContainer = document.getElementById('tabsContainer');
        const searchInput = document.getElementById('searchInput');
        let activeProject = ''; 

        // Function to sanitize text for display (handle file paths)
        function sanitizeLink(link) {
            // Check if the link starts with http, https, or // (protocol-relative) to make it a clickable link
            const isWebLink = link.startsWith('http') || link.startsWith('//');
            
            // If it's a web link, create a standard anchor tag
            if (isWebLink) {
                return `<a href="${link}" target="_blank" class="text-blue-600 hover:text-blue-800">${link.length > 50 ? 'Click to Open Resource' : link}</a>`;
            } 
            // If it's a file path (like \\shared-drive), display it as non-clickable, fixed-width text
            else {
                return `<span class="text-gray-500 font-mono text-xs break-all">${link}</span>`;
            }
        }

        // --- CORE RENDERING LOGIC ---
        function renderTable(projectName) {
            const data = PROJECT_DATA[projectName];
            tableBody.innerHTML = '';

            data.forEach((row, index) => {
                const tr = document.createElement('tr');
                tr.className = index % 2 === 0 ? 'bg-white hover:bg-blue-50' : 'bg-gray-50 hover:bg-blue-50';
                
                tr.innerHTML = `
                    <td class="px-4 py-3 font-medium text-gray-900" data-label="Category">${row.category}</td>
                    <td class="px-4 py-3" data-label="Item/Topic">${row.item}</td>
                    <td class="px-4 py-3" data-label="Description">${row.description}</td>
                    <td class="px-4 py-3" data-label="Link/Location">${sanitizeLink(row.link)}</td>
                    <td class="px-4 py-3 text-sm text-gray-600" data-label="Notes/Comments">${row.notes}</td>
                `;
                tableBody.appendChild(tr);
            });
            activeProject = projectName;
            updateActiveTab(projectName);
            searchInput.value = ''; // Clear search when switching projects
        }

        // --- TAB MANAGEMENT ---
        function updateActiveTab(activeName) {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                if (btn.dataset.project === activeName) {
                    btn.classList.add('active');
                    btn.classList.remove('text-gray-600');
                } else {
                    btn.classList.remove('active');
                    btn.classList.add('text-gray-600');
                }
            });
        }

        function createTabs() {
            Object.keys(PROJECT_DATA).forEach((name, index) => {
                const button = document.createElement('button');
                button.textContent = name;
                button.className = 'tab-btn text-gray-600';
                button.dataset.project = name;
                
                button.addEventListener('click', () => {
                    renderTable(name);
                });
                tabsContainer.appendChild(button);
            });
            // Initial render
            const firstProject = Object.keys(PROJECT_DATA)[0];
            if (firstProject) {
                renderTable(firstProject);
            }
        }

        // --- SEARCH FILTERING LOGIC ---
        searchInput.addEventListener('keyup', function() {
            const filter = searchInput.value.toLowerCase();
            const rows = tableBody.getElementsByTagName('tr');

            for (let i = 0; i < rows.length; i++) {
                let row = rows[i];
                let cells = row.getElementsByTagName('td');
                let found = false;
                
                // Only search Category, Item/Topic, and Description (first 3 cells)
                for (let j = 0; j < 3; j++) {
                    let cell = cells[j];
                    if (cell) {
                        let textValue = cell.textContent || cell.innerText;
                        if (textValue.toLowerCase().indexOf(filter) > -1) {
                            found = true;
                            break;
                        }
                    }
                }
                
                row.style.display = found ? '' : 'none';
            }
        });

        // --- INITIALIZATION: Fetch Data ---
        async function initializeHub() {
            try {
                // FIX: Appending a timestamp query parameter to bypass aggressive caching
                const cacheBuster = `?v=${new Date().getTime()}`;
                
                // FIX 404: Removed leading slash (/) to use relative path, 
                // ensuring it works correctly on GitHub Pages repository subdirectories.
                const dataUrl = `project_data.json${cacheBuster}`; 

                const response = await fetch(dataUrl);
                
                if (!response.ok) {
                    throw new Error(`HTTP status ${response.status}: Failed to load project_data.json`);
                }
                
                PROJECT_DATA = await response.json();
                
                // If data loads successfully, proceed with rendering
                createTabs();

            } catch (error) {
                console.error("Initialization Error:", error);
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="5" class="text-center py-8 text-red-600 font-bold">
                            ERROR: Could not load project data. Ensure 'project_data.json' is in the same folder and the site is hosted correctly.
                            <br><span class="text-sm font-normal text-red-500">Details: ${error.message}</span>
                        </td>
                    </tr>
                `;
            }
        }

        // Initialize the app on load
        document.addEventListener('DOMContentLoaded', initializeHub);
    </script>
    <!-- CACHE BUSTER TAG: V2.6 (Path Fix) -->
</body>
</html>
